!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.IndexedDB=t()}(this,function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.prototype.indexeddb=s,new o(s,e,t,r)}var r=function(){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.db=e;var o=!0===r?"readwrite":"readonly",s=this.db.transaction(n,o);return this.store=s.objectStore(n),this}return function(t,n,r){n&&e(t.prototype,n),r&&e(t,r)}(t,[{key:"add",value:function(e){for(var t=e instanceof Array?e:[e],n=0,r=t.length-1;n<=r;n++)this.store.add(t[n]),n===r&&console.log("数据添加成功");return this}},{key:"put",value:function(e){for(var t=e instanceof Array?e:[e],n=0,r=t.length-1;n<=r;n++)this.store.put(t[n]),n===r&&console.log("数据更新成功");return this}},{key:"delete",value:function(e){for(var t=e instanceof Array?e:[e],n=0,r=t.length-1;n<=r;n++)this.store.delete(t[n]),n===r&&console.log("数据删除成功");return this}},{key:"clear",value:function(){return this.store.clear(),console.log("数据清除成功"),this}},{key:"get",value:function(e,t){var n=this;return this.store.get(e).addEventListener("success",function(e){t&&t.call(n,e)},!1),this}},{key:"cursor",value:function(e){var t=this,n="function"==typeof arguments[1]?arguments[1]:arguments[2],r=this.store.index(e),o=arguments[2]?function(e){if("number"==typeof e)return e;if("string"==typeof e){if(/^\s*>\s*(-?\d+(\.\d+)?)\s*$/i.test(e))return IDBKeyRange.lowerBound(Number(e.match(/(-?\d+(\.\d+)?)/g)[0]),!0);if(/^\s*>\s*=\s*(-?\d+(\.\d+)?)\s*$/i.test(e))return IDBKeyRange.lowerBound(Number(e.match(/(-?\d+(\.\d+)?)/g)[0]));if(/^\s*<\s*(-?\d+(\.\d+)?)\s*$/i.test(e))return IDBKeyRange.upperBound(Number(e.match(/(-?\d+(\.\d+)?)/g)[0]),!0);if(/^\s*<\s*=\s*(-?\d+(\.\d+)?)\s*$/i.test(e))return IDBKeyRange.upperBound(Number(e.match(/(-?\d+(\.\d+)?)/g)[0]));if(/^\s*[\[\(]\s*(-?\d+(\.\d+)?)\s*\,\s*(-?\d+(\.\d+)?)\s*[\]\)]\s*$/i.test(e)){var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,s=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(o)throw s}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e.match(/(-?\d+(\.\d+)?)/g),2),n=t[0],r=t[1],o=!1,s=!1;return/^.*\(.*$/.test(e)&&(o=!0),/^.*\).*$/.test(e)&&(s=!0),IDBKeyRange.bound(Number(n),Number(r),o,s)}return e}}(arguments[1]):null,s=null===o?r.openCursor():r.openCursor(o);return s.addEventListener("success",function(e){n&&n.call(t,e)},!1),this}}]),t}(),o=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexeddb=t,this.name=n,this.version=r,this.callbackObject=o,this.db=null,this.request=this.indexeddb.open(n,r),this.request.addEventListener("success",this.openSuccess.bind(this),!1),this.request.addEventListener("error",this.openError.bind(this),!1),this.request.addEventListener("upgradeneeded",this.openUpgradeneeded.bind(this),!1)}return function(e,n,r){n&&t(e.prototype,n),r&&t(e,r)}(e,[{key:"openSuccess",value:function(e){this.callbackObject.success&&(this.db=e.target.result,this.callbackObject.success.call(this,e)),console.log("打开数据库成功！\nname:    ".concat(this.name,"\nversion: ").concat(this.version))}},{key:"openError",value:function(e){this.callbackObject.error&&(console.error(e.target.error.message),this.callbackObject.error.call(this,e)),console.log("打开数据库失败！\nname:    ".concat(this.name,"\nversion: ").concat(this.version))}},{key:"openUpgradeneeded",value:function(e){this.callbackObject.upgradeneeded&&(this.db=e.target.result,this.callbackObject.upgradeneeded.call(this,e)),console.log("数据库版本更新！\nname:    ".concat(this.name,"\nversion: ").concat(this.version))}},{key:"close",value:function(){this.db.close(),this.db=null,console.log("数据库关闭。\nname:    ".concat(this.name,"\nversion: ").concat(this.version))}},{key:"hasObjectStore",value:function(e){return this.db.objectStoreNames.contains(e)}},{key:"createObjectStore",value:function(e,t,n){if(this.hasObjectStore(e))console.warn("ObjectStore：".concat(e,"已存在。"));else{var r=this.db.createObjectStore(e,{keyPath:t});if(n)for(var o=0,s=n.length;o<s;o++)r.createIndex(n[o].name,n[o].index);console.log("创建了新的ObjectStore：".concat(e,"。"))}return this}},{key:"deleteObjectStore",value:function(e){return this.hasObjectStore(e)?(this.db.deleteObjectStore(e),console.log("删除了新的ObjectStore：".concat(e,"。"))):console.warn("ObjectStore：".concat(e,"不存在。")),this}},{key:"getObjectStore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new r(this.db,e,t)}}]),e}(),s=indexedDB||webkitIndexedDB||mozIndexedDB||msIndexedDB;return n.deleteDatabase=function(e){s.deleteDatabase(e),console.log("删除数据库：".concat(e,"。"))},n});
